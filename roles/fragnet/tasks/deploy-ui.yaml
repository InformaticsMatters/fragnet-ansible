---

- name: Include pull secrets
  include_vars:
    file: pull-secrets.vault

# Create secret objects for each image pull secret defined.
# These are typically used to pull container images
# from private registries.

- name: Create image pull secrets
  k8s:
    definition: "{{ lookup('template', 'secret-imagepull.yaml.j2') }}"
    wait: yes
  vars:
    pull_name: "{{ item.name }}"
    pull_secret: "{{ item.secret }}"
  with_items: "{{ fs_pull_secrets }}"

# Set the 'services' hostname fact.
# It's either co-located (i.e. the same as 'fs_hostname')
# or remote (i.e. 'fs_remote_services_hostname' is set)

- name: Set services hostname (co-located)
  set_fact:
    fs_services_hostname_fact: "{{ fs_fs_hostname }}"
  when: fs_remote_services_hostname|string|length == 0

- name: Set services hostname (remote)
  set_fact:
    fs_services_hostname_fact: "{{ fs_remote_services_hostname }}"
  when: fs_remote_services_hostname|string|length > 0

- name: Deploy Fragnet UI objects
  k8s:
    definition: "{{ lookup('template', '{{ item }}.yaml.j2') }}"
    wait: yes
    wait_timeout: "{{ fs_pod_ready_timeout }}"
  loop:
  - configmap-services
  - configmap-ui
  - deployment-ui
